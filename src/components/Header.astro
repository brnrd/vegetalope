---
import { Image } from 'astro:assets';
import { SITE_TITLE } from '../consts'
import logoImage from '../assets/vegetalope-transparent.avif'
---

<header class="site-header">
	<div class="inner">
		<h2>
			<a class="site-logo" href="/" aria-label={SITE_TITLE}>
				<Image
					src={logoImage}
					alt={SITE_TITLE}
					class="site-logo-mark"
					formats={['webp', 'avif']}
					widths={[140, 200, 280, 360]}
					loading="eager"
					decoding="async"
					fetchpriority="high"
					sizes="(max-width: 720px) 140px, 200px"
				/>
				<span class="sr-only">{SITE_TITLE}</span>
			</a>
		</h2>

		<button class="menu-toggle" type="button" aria-expanded="false" aria-controls="site-nav">
			<span class="sr-only">Toggle navigation</span>
			<span class="menu-lines" aria-hidden="true"></span>
		</button>

		<nav id="site-nav" class="site-nav" aria-label="Site">
			<a href="/about">About</a>
			<a href="https://x.com/vegetalope">X</a>
			<a href="https://www.linkedin.com/in/bernarddebecker/">LinkedIn</a>
			<a href="https://github.com/brnrd">GitHub</a>
		</nav>
	</div>
</header>

<style>
	/* Keep this file almost unstyled. */
</style>

<script is:inline>
	const header = document.querySelector('.site-header');
	const button = document.querySelector('.menu-toggle');
	const nav = document.querySelector('#site-nav');

	if (header && button && nav) {
		const closeMenu = () => {
			header.classList.remove('menu-open');
			button.setAttribute('aria-expanded', 'false');
		};

		button.addEventListener('click', () => {
			const isOpen = header.classList.toggle('menu-open');
			button.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
		});

		nav.addEventListener('click', (event) => {
			const target = event.target;
			if (target && target.matches('a')) {
				closeMenu();
			}
		});

		window.addEventListener('keydown', (event) => {
			if (event.key === 'Escape') {
				closeMenu();
			}
		});
	}
</script>
