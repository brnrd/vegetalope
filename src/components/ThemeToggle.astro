---
const themes = ['auto', 'light', 'dark'];
---

<fieldset class="theme-toggle" data-theme-toggle>
	<legend class="sr-only">Colour theme</legend>

	{themes.map((t) => (
		<label>
			<input type="radio" name="theme" value={t} aria-label={`Use ${t} theme`} />
			<span aria-hidden="true">
				<span class="btn-text">{t}</span>
			</span>
		</label>
	))}
</fieldset>

<script is:inline>
	(() => {
		if (typeof document === 'undefined') return;

		const root = document.documentElement;
		const container = document.querySelector('[data-theme-toggle]');
		if (!container) return;

		const inputs = Array.from(container.querySelectorAll('input[name="theme"]'));
		if (!inputs.length) return;

		const media = window.matchMedia('(prefers-color-scheme: dark)');

		const getStoredTheme = () => {
			const stored = localStorage.getItem('theme');
			if (stored === 'light' || stored === 'dark' || stored === 'auto') return stored;
			return 'auto';
		};

		const applyTheme = (theme) => {
			const isDark = theme === 'dark' || (theme === 'auto' && media.matches);
			root.classList.toggle('theme-dark', isDark);
			localStorage.setItem('theme', theme);
			for (const input of inputs) {
				input.checked = input.value === theme;
			}
		};

		applyTheme(getStoredTheme());

		for (const input of inputs) {
			input.addEventListener('change', () => applyTheme(input.value));
		}

		media.addEventListener('change', () => {
			if (getStoredTheme() === 'auto') {
				applyTheme('auto');
			}
		});
	})();
</script>

<style>
	/* Keep this component visually neutral */
	fieldset {
		border: 0;
		padding: 0;
		margin: 0;
		display: inline-flex;
		flex-direction: column;
		align-items: flex-start;
		gap: 0.2rem;
	}

	label {
		display: inline-flex;
		align-items: center;
		cursor: pointer;
		position: relative;
	}

	/* Visually hide the legend but keep it accessible */
	.sr-only {
		position: absolute;
		width: 1px;
		height: 1px;
		padding: 0;
		margin: -1px;
		overflow: hidden;
		clip: rect(0, 0, 0, 0);
		white-space: nowrap;
		border: 0;
	}

	/*
	  Do NOT remove the radios from the accessibility tree.
	  Just make them unobtrusive visually.
	*/
	input {
		margin: 0;
		position: absolute;
		opacity: 0;
		pointer-events: none;
	}

	/*
	  Small visual hint for the current theme,
	  without introducing colours.
	*/
	span {
		display: inline-flex;
		align-items: center;
		justify-content: center;
		gap: 0.25rem;
		padding: 0.2rem 0.45rem;
		border-radius: 0;
		border: 0;
		background: transparent;
		opacity: 1;
		color: var(--color-ink);
		line-height: 1;
		transition: background-color 120ms ease, color 120ms ease, border-color 120ms ease;
		white-space: nowrap;
	}

	label:hover span {
		text-decoration: underline;
	}

	input:checked + span {
		text-decoration: underline;
	}

	input:focus-visible + span {
		outline: 2px solid currentColor;
		outline-offset: 2px;
	}

	.btn-text {
		text-transform: capitalize;
		font-size: 0.7rem;
		letter-spacing: 0.18em;
		text-transform: uppercase;
	}
</style>
