---
import DyssExample from '../../../../layouts/DyssExample.astro';
import dyssPieDemoScript from '../../../../scripts/dyss-pie-demo.js?url&no-inline';

const title = 'dyss: dynamic pie chart playground';
const description = 'A small dyss use-case: tweak pie chart inputs and let CSS update itself.';
---

<DyssExample title={title} description={description}>
	<p>
		This is a practical use-case for <a href="https://github.com/brnrd/dyss">dyss</a>, inspired by the CSS
		pie-chart exploration on CSS-Tricks.
	</p>

	<p>
		The goal: adjust segment values without manually recalculating percentages or <code>conic-gradient</code>
		stops.
	</p>

	<div class="dyss-demo stack" data-dyss-demo>
		<form class="dyss-controls stack" data-dyss-controls>
			<fieldset>
				<legend>Pie chart values</legend>
				<div class="dyss-rows stack" data-dyss-rows></div>
				<div class="dyss-actions">
					<button type="button" data-dyss-add>Add service</button>
				</div>
			</fieldset>
		</form>

		<div class="dyss-preview stack">
			<figure class="dyss-chart-wrap">
				<div class="dyss-pie" role="img" aria-label="Dynamic revenue split pie chart"></div>
				<figcaption>Revenue split</figcaption>
				<div class="dyss-runtime">
					<button type="button" data-dyss-live aria-pressed="false">Start live data</button>
					<label class="dyss-interval">
						<span>Interval</span>
						<select data-dyss-interval>
							<option value="1">1ms</option>
							<option value="10">10ms</option>
							<option value="50" selected>50ms</option>
							<option value="100">100ms</option>
							<option value="500">500ms</option>
							<option value="1000">1000ms</option>
						</select>
					</label>
					<p data-dyss-fps>0.0 FPS</p>
				</div>
			</figure>
			<ul class="dyss-legend" data-dyss-legend></ul>
		</div>

		<section class="dyss-code stack" aria-label="Live code preview">
			<h3>Live code</h3>
			<pre><code data-dyss-code></code></pre>
		</section>
	</div>

	<p class="dyss-note">
		CSS-Tricks reference:
		<a href="https://css-tricks.com/trying-to-make-the-perfect-pie-chart-in-css/">
			Trying to make the perfect pie chart in CSS
		</a>
	</p>

	<script slot="scripts" type="module" src={dyssPieDemoScript}></script>
</DyssExample>

<style>
	.dyss-demo {
		padding: 1rem;
		border: 1px solid var(--hairline);
		border-radius: 0.75rem;
		background: color-mix(in oklab, var(--color-bg) 92%, white);
	}

	.dyss-controls fieldset {
		border: 1px solid var(--hairline);
		padding: 0.9rem;
		margin: 0;
	}

	.dyss-controls legend {
		font-family: var(--font-label);
		font-size: 0.72rem;
		letter-spacing: 0.12em;
		text-transform: uppercase;
	}

	.dyss-rows {
		margin-top: 0.5rem;
	}

	:global(.dyss-row) {
		display: grid;
		grid-template-columns: minmax(110px, 160px) 1fr 48px 48px auto;
		gap: 0.5rem;
		align-items: center;
	}

	:global(.dyss-row input[type='text']) {
		inline-size: 100%;
	}

	:global(.dyss-row input[type='range']) {
		inline-size: 100%;
	}

	:global(.dyss-row output) {
		font-family: var(--font-label);
		font-size: 0.8rem;
		text-align: right;
	}

	:global(.dyss-row input[type='color']) {
		inline-size: 42px;
		block-size: 34px;
		padding: 0;
		border: 1px solid var(--hairline);
		background: transparent;
	}

	:global(.dyss-row button) {
		display: inline-flex;
		align-items: center;
		justify-content: center;
		block-size: 34px;
		padding: 0.45rem 0.6rem;
		font-size: 0.62rem;
		background: transparent;
		color: var(--color-ink);
		border: 1px solid var(--hairline);
	}

	.dyss-actions {
		margin-top: 0.8rem;
	}

	.dyss-actions button {
		padding: 0.45rem 0.75rem;
		font-size: 0.62rem;
		background: transparent;
		color: var(--color-ink);
		border: 1px solid var(--hairline);
	}

	.dyss-actions button:hover,
	:global(.dyss-row button:hover) {
		background: color-mix(in oklab, var(--color-bg) 78%, var(--color-ink) 22%);
		color: var(--color-ink);
	}

	:global(.dyss-row button[disabled]) {
		opacity: 0.55;
		cursor: not-allowed;
	}

	.dyss-code {
		margin-top: 1rem;
	}

	.dyss-code h3 {
		font-size: 1rem;
		margin: 0;
	}

	.dyss-code pre {
		margin: 0;
		font-size: 0.8rem;
		line-height: 1.5;
		max-block-size: 280px;
	}

	.dyss-preview {
		margin-top: 1rem;
		display: grid;
		grid-template-columns: minmax(180px, 230px) 1fr;
		gap: 1rem;
		align-items: start;
	}

	.dyss-chart-wrap {
		margin: 0;
		display: grid;
		gap: 0.6rem;
		justify-items: center;
	}

	.dyss-chart-wrap figcaption {
		font-size: 0.82rem;
		color: var(--color-ink-muted);
	}

	.dyss-runtime {
		display: inline-flex;
		align-items: center;
		gap: 0.6rem;
		flex-wrap: wrap;
	}

	.dyss-runtime button {
		padding: 0.4rem 0.65rem;
		font-size: 0.62rem;
		background: var(--color-bg);
		color: var(--color-ink);
		border: 1px solid var(--hairline);
	}

	.dyss-runtime button:hover {
		background: color-mix(in oklab, var(--color-bg) 75%, var(--color-ink) 25%);
		color: var(--color-ink);
	}

	.dyss-runtime button[aria-pressed='true'] {
		background: var(--color-ink);
		color: var(--color-bg);
	}

	.dyss-runtime p {
		margin: 0;
		font-family: var(--font-label);
		font-size: 0.68rem;
		letter-spacing: 0.1em;
		text-transform: uppercase;
	}

	.dyss-interval {
		display: inline-flex;
		align-items: center;
		gap: 0.4rem;
		font-family: var(--font-label);
		font-size: 0.62rem;
		letter-spacing: 0.1em;
		text-transform: uppercase;
	}

	.dyss-interval select {
		padding: 0.3rem 0.45rem;
		background: var(--color-bg);
		color: var(--color-ink);
		border: 1px solid var(--hairline);
		border-radius: 0;
	}

	.dyss-pie {
		inline-size: min(42vw, 220px);
		aspect-ratio: 1;
		border-radius: 50%;
		border: 1px solid var(--hairline);
		box-shadow: inset 0 0 0 1px color-mix(in oklab, black 10%, transparent);
		background-image: conic-gradient(#ddd 0deg 360deg);
	}

	.dyss-legend {
		list-style: none;
		padding: 0;
		margin: 0;
		display: grid;
		gap: 0.75rem;
	}

	:global(.dyss-legend-item) {
		display: grid;
		grid-template-columns: 14px minmax(140px, 1fr) minmax(40px, 64px) minmax(56px, 80px);
		align-items: center;
		column-gap: 0.75rem;
		font-size: 1rem;
		line-height: 1.4;
		padding-block: 0.1rem;
	}

	:global(.dyss-legend-item .swatch) {
		inline-size: 14px;
		block-size: 14px;
		border-radius: 3px;
	}

	:global(.dyss-legend-item em) {
		font-style: normal;
		color: var(--color-ink-muted);
	}

	.dyss-note {
		font-size: 0.88rem;
		color: var(--color-ink-muted);
	}

	@media (max-width: 900px) {
		:global(.dyss-row) {
			grid-template-columns: 1fr;
		}

		:global(.dyss-row output) {
			text-align: left;
		}
	}

	@media (max-width: 760px) {
		.dyss-preview {
			grid-template-columns: 1fr;
		}
	}

	@media (min-width: 1080px) {
		.dyss-runtime {
			inline-size: min(520px, 100%);
			justify-content: space-between;
			gap: 0.9rem;
		}

		.dyss-runtime p {
			margin-left: auto;
			text-align: right;
		}
	}
</style>
