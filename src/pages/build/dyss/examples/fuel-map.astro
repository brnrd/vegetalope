---
import DyssExample from '../../../../layouts/DyssExample.astro';
import LiveCodeSection from '../../../../components/dyss/LiveCodeSection.astro';
import dyssFuelMapDemoScript from '../../../../scripts/dyss-fuel-map-demo.js?url&no-inline';

const title = 'dyss: AFR fuel map';
const description = 'A live AFR fuel map table with dynamic CSS rules per cell.';
---

<DyssExample title={title} description={description}>
	<p>
		This example simulates an AFR fuel map: RPM on the X axis, LOAD on the Y axis (low at top, high at bottom).
		Live mode moves a coherent operating point and updates nearby cells smoothly.
	</p>

	<div class="fuel-map-demo stack" data-dyss-fuel-map>
		<div class="fuel-map-controls">
			<button type="button" data-dyss-live aria-pressed="false">Start live data</button>
			<label class="fuel-map-interval">
				<span>Interval</span>
				<select data-dyss-interval>
					<option value="10">10ms</option>
					<option value="50" selected>50ms</option>
					<option value="100">100ms</option>
					<option value="250">250ms</option>
					<option value="500">500ms</option>
				</select>
			</label>
			<button type="button" data-dyss-reseed>Reseed grid</button>
			<p class="fuel-map-fps" data-dyss-fps>0.0 FPS</p>
		</div>

		<div class="fuel-map-table-wrap">
			<table class="fuel-map-table" aria-label="AFR fuel map table">
				<thead data-dyss-head></thead>
				<tbody data-dyss-body></tbody>
			</table>
		</div>
		<p class="fuel-map-axis-note">X axis: RPM left to right. Y axis: LOAD low to high (top to bottom).</p>

		<LiveCodeSection className="fuel-map-code" />
	</div>

	<script slot="scripts" type="module" src={dyssFuelMapDemoScript}></script>
</DyssExample>

<style>
	.fuel-map-demo {
		padding: 1rem;
		border: 1px solid var(--hairline);
		border-radius: 0.75rem;
		background: color-mix(in oklab, var(--color-bg) 92%, white);
	}

	.fuel-map-controls {
		display: flex;
		flex-wrap: wrap;
		gap: 0.75rem;
		align-items: center;
	}

	.fuel-map-controls button {
		padding: 0.45rem 0.8rem;
		font-size: 0.64rem;
		background: transparent;
		color: var(--color-ink);
		border: 1px solid var(--hairline);
	}

	.fuel-map-interval {
		display: inline-flex;
		align-items: center;
		gap: 0.5rem;
		font-family: var(--font-label);
		font-size: 0.7rem;
		letter-spacing: 0.12em;
		text-transform: uppercase;
	}

	.fuel-map-interval select {
		padding: 0.35rem 0.5rem;
		border-radius: 0;
	}

	.fuel-map-fps {
		font-family: var(--font-label);
		font-size: 0.7rem;
		letter-spacing: 0.12em;
		text-transform: uppercase;
		color: var(--color-ink-muted);
		margin: 0;
	}

	.fuel-map-table-wrap {
		overflow-x: auto;
		border: 1px solid var(--hairline);
	}

	.fuel-map-table {
		width: 100%;
		border-collapse: collapse;
		min-width: 940px;
		font-size: 0.79rem;
	}

	.fuel-map-table th,
	.fuel-map-table td {
		border: 1px solid color-mix(in oklab, var(--color-ink) 12%, transparent);
		padding: 0.34rem 0.38rem;
		text-align: center;
	}

	.fuel-map-table th {
		font-family: var(--font-label);
		font-size: 0.58rem;
		letter-spacing: 0.1em;
		text-transform: uppercase;
		background: color-mix(in oklab, var(--color-bg) 88%, black);
	}

	.fuel-map-table td {
		font-variant-numeric: tabular-nums;
		font-family: var(--font-label);
		font-size: 0.69rem;
		letter-spacing: 0.04em;
		transition: background-color 120ms ease, color 120ms ease;
	}

	:global(.fm-cell) {
		font-weight: 600;
	}

	.fuel-map-code {
		--dyss-code-max-height: 320px;
	}

	.fuel-map-axis-note {
		margin: 0;
		font-family: var(--font-label);
		font-size: 0.68rem;
		letter-spacing: 0.09em;
		text-transform: uppercase;
		color: var(--color-ink-muted);
	}

	@media (max-width: 760px) {
		.fuel-map-controls {
			align-items: flex-start;
		}
	}
</style>
